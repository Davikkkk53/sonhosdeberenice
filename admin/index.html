<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel Admin – Catálogo</title>
<style>
body{
    font-family: Arial, sans-serif;
    background:#f5f5f5;
    padding:20px;
    margin:0;
}
.container{
    max-width:900px;
    margin:0 auto;
    background:white;
    padding:20px;
    border-radius:8px;
    box-shadow:0 0 20px rgba(0,0,0,.06);
}

input, select, button, textarea{
    width:100%;
    padding:10px;
    margin:8px 0;
    border-radius:6px;
    border:1px solid #ccc;
    font-size:15px;
}

button{
    background:#2b77ff;
    color:white;
    cursor:pointer;
    border:none;
}
button:hover{
    filter:brightness(.9);
}

.produto{
    background:white;
    padding:15px;
    border-radius:8px;
    margin-top:20px;
    border:1px solid #ddd;
}
.produto-header{
    display:flex;
    justify-content:space-between;
    font-weight:bold;
    align-items:center;
    gap:10px;
}
.produto img{
    max-width:150px;
    display:block;
    margin-top:5px;
}
.produto button{
    margin-top:5px;
    width:auto;
    padding:6px 10px;
    font-size:14px;
}
</style>
</head>
<body>

<div class="container">
    <h2>Painel Admin – Catálogo</h2>
    <p>Adicione ou altere produtos</p>

    <h3>Novo Produto</h3>
    <form id="formProduto">
        <input name="nome" placeholder="Nome do produto" required>
        <input name="tamanhos" placeholder="Tamanhos (ex: P,M,G)" required>
        <input name="preco" placeholder="Preço atual (ex: 89.90)" type="number" step="0.01" required>
        <input name="preco_antigo" placeholder="Preço antigo (opcional)" type="number" step="0.01">
        <input name="desconto" placeholder="Desconto (%)" type="number" step="1">
        <input name="whatsapp" placeholder="Telefone WhatsApp (ex: 5511999999999)" required>
        <input name="imagem" type="file" accept="image/*" required>
        <select name="status">
            <option value="ativo">Ativo</option>
            <option value="inativo">Inativo</option>
        </select>
        <button type="submit">Salvar</button>
    </form>

    <h3 style="margin-top:30px;">Produtos cadastrados</h3>
    <div id="lista"></div>
</div>

<script>
const form = document.getElementById('formProduto');
const lista = document.getElementById('lista');

// ROTAS relativas porque server.js serve client/admin na mesma porta
const BACKEND_URL = '';

// Carregar produtos do backend
async function carregarProdutos() {
    try {
        const res = await fetch(`${BACKEND_URL}/produtos`);
        const produtos = await res.json();
        renderLista(produtos);
    } catch(err){
        console.error('Erro ao carregar produtos:', err);
        lista.innerHTML = '<p>Não foi possível carregar os produtos.</p>';
    }
}

// Renderizar lista de produtos
function renderLista(produtos){
    lista.innerHTML = '';
    produtos.forEach(p => {
        lista.innerHTML += `
        <div class="produto">
            <div class="produto-header">
                <span>${p.nome}</span>
                <span>Status: ${p.status.toUpperCase()}</span>
            </div>
            <div>Tamanhos: ${p.tamanhos.join(', ')}</div>
            <div>Preço: R$ ${p.preco}</div>
            ${p.preco_antigo ? `<div>Antes: R$ ${p.preco_antigo}</div>` : ''}
            ${p.desconto ? `<div>Desconto: ${p.desconto}%</div>` : ''}
            <div>WhatsApp: ${p.whatsapp}</div>
            <div>Imagem:</div>
            <img src="${p.imagem}" alt="${p.nome}">
            <div>
                <button onclick="alterarStatus('${p._id}', '${p.status === 'ativo' ? 'inativo' : 'ativo'}')">
                    ${p.status === 'ativo' ? 'Desativar' : 'Ativar'}
                </button>
                <button onclick="deletarProduto('${p._id}')">Deletar</button>
            </div>
        </div>
        `;
    });
}

// Enviar novo produto para backend
form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const formData = new FormData(form);

    try {
        const res = await fetch(`${BACKEND_URL}/produtos`, {
            method: 'POST',
            body: formData
        });
        await res.json();
        alert('Produto salvo com sucesso!');
        form.reset();
        carregarProdutos();
    } catch(err){
        console.error(err);
        alert('Erro ao salvar produto.');
    }
});

// Alterar status
async function alterarStatus(id, novoStatus){
    try{
        await fetch(`${BACKEND_URL}/produtos/${id}/status`, {
            method:'PATCH',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({status:novoStatus})
        });
        carregarProdutos();
    }catch(err){
        alert('Erro ao alterar status');
        console.error(err);
    }
}

// Deletar produto
async function deletarProduto(id){
    if(!confirm('Deseja realmente deletar este produto?')) return;
    try{
        await fetch(`${BACKEND_URL}/produtos/${id}`, {method:'DELETE'});
        carregarProdutos();
    }catch(err){
        alert('Erro ao deletar produto');
        console.error(err);
    }
}

// Inicializa
carregarProdutos();
</script>

</body>
</html>
